from typing import Annotated, List, Optional, TypedDict
from langchain_core.messages import BaseMessage
from langgraph.graph.message import add_messages


class AgentState(TypedDict):
    """
    State definition for the Analyst Graph.
    Acts as the contract between nodes.
    """

    messages: Annotated[List[BaseMessage], add_messages]
    guardrail_verdict: Optional[str]
    plan: Optional[str]  # Decomposition of the user query
    sql_query: Optional[str] # SQL generated by Fiscal Agent
    code: str
    output: str
    error: Optional[str]
    evaluation: Optional[str]  # Critic's feedback
    iterations: int
